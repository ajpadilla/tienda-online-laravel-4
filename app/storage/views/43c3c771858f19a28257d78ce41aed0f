<?php $__env->startSection('title'); ?>
	<?php echo trans('PaymentCredentialDetails.title'); ?>

<?php $__env->stopSection(); ?>

<?php $__env->startSection('content'); ?>

<div class="row">
	<div class="col-lg-12">
		<div class="ibox float-e-margins">
			<div class="ibox-title">
				<h5><?php echo trans('PaymentCredentialDetails.subtitle'); ?></h5>
			</div>
			<div class="ibox-content">
				<div class="row">
					<?php echo Form::open(['route' => 'PaymentCredentialDetails.store', 'class' => 'form-horizontal', 'id' => 'formCreateCredentials']); ?>

						<?php echo $__env->make('payment_credential_details.partials._form', array_except(get_defined_vars(), array('__data', '__path')))->render(); ?>
					<?php echo Form::close(); ?>

				</div>
			</div>
		</div>
	</div>
</div>
<?php $__env->stopSection(); ?>

<?php $__env->startSection('scripts'); ?>
	<script type="text/javascript">
		$(document).ready(function () 
		{

			// Iniciar select chosen
			$('.chosen-select').chosen();

			$('#credit_cart_expire_date').datepicker({
				showButtonPanel: true,
				changeMonth: true,
				changeYear: true,
				dateFormat: '<?php echo trans('PaymentCredentialDetails.date'); ?>',
			});

			$.validator.addMethod('onlyLettersNumbersAndSpaces', function(value, element) {
				return this.optional(element) || /^[a-zA-Z0-9ñÑ\s]+$/i.test(value);
			}, '<?php echo trans('products.validation.onlyLettersNumbersAndSpaces'); ?>');

			$.validator.addMethod('onlyLettersNumbersAndDash', function(value, element) {
				return this.optional(element) || /^[a-zA-Z0-9ñÑ\-]+$/i.test(value);
			}, '<?php echo trans('products.validation.onlyLettersNumbersAndDash'); ?>');

			jQuery.validator.addMethod("decimalNumbers", function(value, element) {
				return this.optional(element) || /^\d{0,20}(\.\d{0,6})?$/i.test(value);
			}, '<?php echo trans('products.validation.maxlength'); ?>'+[20]+'<?php echo trans('products.validation.length'); ?>' + '<?php echo trans('products.validation.maxlengthDecimal'); ?>'+ [6] + '<?php echo trans('products.validation.decimal'); ?>');

			jQuery.validator.addMethod('customDateValidator', function(value, element) {
				try{
					jQuery.datepicker.parseDate( '<?php echo trans('PaymentCredentialDetails.date'); ?>' , value);return true;}
					catch(e){return false;}
				},'<?php echo trans('discounts.validation.date'); ?>');

			$('#formCreateCredentials').validate({
				rules:{
					email:{
     					 email: true,
					},
					credit_cart_number:{
						onlyLettersNumbersAndSpaces:true
					},
					credit_cart_security_number:{
						onlyLettersNumbersAndSpaces:true
					},
					credit_cart_expire_date:{
						customDateValidator:true
					}
				},
				messages:{
					email: '<?php echo trans('PaymentCredentialDetails.validation.email'); ?>'
				},
				highlight:function(element){
					$(element).closest('.form-group').removeClass('has-success').addClass('has-error');
				},
				unhighlight:function(element){
					$(element).closest('.form-group').removeClass('has-error');
				},
				success:function(element){
					element.addClass('valid').closest('.form-group').removeClass('has-error').addClass('has-success');
				}
			});

			var options = {
					beforeSubmit:  showRequest,  // pre-submit callback
					success:       showResponse,  // post-submit callback
					url:  '<?php echo URL::route('PaymentCredentialDetails.store'); ?>',
					type:'POST'
				};
			$('#formCreateCredentials').ajaxForm(options);
		});

			// pre-submit callback
			function showRequest(formData, jqForm, options) {
				setTimeout(jQuery.fancybox({
					'content':'<h1>' + '<?php echo trans('PaymentCredentialDetails.sending'); ?>' + '</h1>',
					'autoScale' : true,
					'transitionIn' : 'none',
					'transitionOut' : 'none',
					'scrolling' : 'no',
					'type' : 'inline',
					'showCloseButton' : false,
					'hideOnOverlayClick' : false,
					'hideOnContentClick' : false
				}), 5000 );
				return $('#formCreateCredentials').valid();
			}

			// post-submit callback
			function showResponse(responseText, statusText, xhr, $form)  {

				console.log(responseText);

				jQuery.fancybox({
					'content' : '<h1>'+ responseText + '</h1>',
					'autoScale' : true
				});
			}
			
	</script>
<?php $__env->stopSection(); ?>

<?php echo $__env->make('layouts.template', array_except(get_defined_vars(), array('__data', '__path')))->render(); ?>